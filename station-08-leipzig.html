<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîó Station 8: N√ºrnberg - Konnektoren</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Fredoka:wght@400;500;600&display=swap" rel="stylesheet">
    <script data-goatcounter="https://aguitoo.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --ice-blue: #E0F4FF; --deep-blue: #1E3A5F; --winter-blue: #5B9BD5; --snow-white: #FFFFFF; --crystal-cyan: #7DD3FC; --warm-gold: #FFD700; --rubin: #E63946; --smaragd: #06D6A0; --amethyst: #9D4EDD; }
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #1E3A5F 0%, #2D5A8C 50%, #3B7EC4 100%); min-height: 100vh; color: #FFFFFF; padding: 20px; padding-bottom: 100px; }
        .container { max-width: 900px; margin: 0 auto; }
        .station-header { background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(15px); border-radius: 30px; padding: 30px; margin-bottom: 30px; text-align: center; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2); }
        .station-icon { font-size: 4em; margin-bottom: 10px; }
        .station-title { font-family: 'Fredoka', sans-serif; font-size: 2.2em; color: #FFD700; margin-bottom: 5px; }
        .station-subtitle { font-size: 1.1em; color: #E0F4FF; }
        .home-btn { position: fixed; top: 20px; left: 20px; background: rgba(255,255,255,0.2); border: none; padding: 10px 15px; border-radius: 10px; color: white; cursor: pointer; font-size: 1.2em; z-index: 1000; }
        .home-btn:hover { background: rgba(255,255,255,0.3); }
        .section { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-radius: 20px; padding: 25px; margin-bottom: 25px; border: 2px solid rgba(255, 255, 255, 0.2); }
        .section h2 { font-family: 'Fredoka', sans-serif; color: #FFD700; margin-bottom: 15px; font-size: 1.4em; }
        .story-box { background: rgba(255, 215, 0, 0.15); border-left: 4px solid #FFD700; padding: 20px; border-radius: 0 15px 15px 0; line-height: 1.8; }
        .story-box p { margin-bottom: 12px; }
        .story-box strong { color: #FFD700; }
        .story-box em { color: #7DD3FC; }
        .collapsible { background: rgba(255, 255, 255, 0.1); border: none; padding: 15px 20px; width: 100%; text-align: left; color: #FFD700; font-size: 1.2em; font-family: 'Fredoka', sans-serif; cursor: pointer; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; }
        .collapsible:hover { background: rgba(255, 255, 255, 0.2); }
        .collapsible-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; background: rgba(255, 255, 255, 0.05); border-radius: 0 0 15px 15px; }
        .collapsible-content.open { max-height: 4000px; }
        .collapsible-inner { padding: 20px; line-height: 1.7; }
        .collapsible-inner h3 { color: #7DD3FC; margin: 15px 0 10px 0; }
        .grammar-table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        .grammar-table th, .grammar-table td { border: 1px solid rgba(255,255,255,0.3); padding: 8px 12px; text-align: center; }
        .grammar-table th { background: rgba(255,215,0,0.2); color: #FFD700; }
        .grammar-note { background: rgba(125,211,252,0.2); padding: 10px 15px; border-radius: 10px; margin: 10px 0; border-left: 3px solid #7DD3FC; }
        .grammar-warning { background: rgba(230,57,70,0.2); padding: 10px 15px; border-radius: 10px; margin: 10px 0; border-left: 3px solid #E63946; }
        .vocab-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
        .vocab-item { background: rgba(255, 255, 255, 0.1); padding: 12px; border-radius: 10px; display: flex; align-items: center; gap: 10px; }
        .vocab-emoji { font-size: 1.5em; }
        .vocab-word { font-weight: 600; color: #FFD700; }
        .vocab-meaning { font-size: 0.85em; color: #E0F4FF; }
        .level-selection { text-align: center; }
        .level-btn { display: inline-block; padding: 20px 40px; margin: 10px; border-radius: 15px; border: 3px solid; cursor: pointer; font-family: 'Fredoka', sans-serif; font-size: 1.2em; transition: transform 0.2s; background: rgba(255,255,255,0.1); }
        .level-btn:hover { transform: scale(1.05); }
        .level-rubin { border-color: #E63946; color: #E63946; }
        .level-smaragd { border-color: #06D6A0; color: #06D6A0; }
        .level-amethyst { border-color: #9D4EDD; color: #9D4EDD; }
        .level-dot { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .dot-rubin { background: #E63946; }
        .dot-smaragd { background: #06D6A0; }
        .dot-amethyst { background: #9D4EDD; }
        .quiz-area { display: none; }
        .quiz-area.active { display: block; }
        .progress-bar { background: rgba(255,255,255,0.2); height: 12px; border-radius: 6px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #06D6A0, #7DD3FC); transition: width 0.3s; }
        .question-counter { text-align: center; margin-bottom: 15px; color: #E0F4FF; }
        .question-box { background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; margin-bottom: 20px; }
        .question-context { color: #7DD3FC; font-size: 0.9em; margin-bottom: 10px; }
        .question-text { font-size: 1.3em; margin-bottom: 20px; line-height: 1.5; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .option-btn { background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); padding: 15px; border-radius: 12px; color: white; cursor: pointer; font-size: 1.1em; transition: all 0.2s; }
        .option-btn:hover { background: rgba(255,255,255,0.2); border-color: #7DD3FC; }
        .option-btn.correct { background: rgba(6, 214, 160, 0.3); border-color: #06D6A0; }
        .option-btn.wrong { background: rgba(230, 57, 70, 0.3); border-color: #E63946; }
        .option-btn:disabled { cursor: not-allowed; }
        .gap-input { background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); padding: 12px 20px; border-radius: 10px; color: white; font-size: 1.2em; width: 200px; text-align: center; }
        .gap-input:focus { outline: none; border-color: #7DD3FC; }
        .gap-input.correct { border-color: #06D6A0; background: rgba(6,214,160,0.2); }
        .gap-input.wrong { border-color: #E63946; background: rgba(230,57,70,0.2); }
        .check-btn { background: #5B9BD5; border: none; padding: 12px 30px; border-radius: 10px; color: white; font-size: 1.1em; cursor: pointer; margin-top: 15px; }
        .check-btn:hover { background: #4A8BC4; }
        .ordering-container { margin: 15px 0; }
        .ordering-source, .ordering-target { display: flex; flex-wrap: wrap; gap: 10px; min-height: 50px; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        .ordering-source { background: rgba(255,255,255,0.1); }
        .ordering-target { background: rgba(125,211,252,0.2); border: 2px dashed rgba(125,211,252,0.5); }
        .ordering-word { background: rgba(255,215,0,0.2); border: 2px solid #FFD700; padding: 10px 18px; border-radius: 8px; cursor: pointer; font-size: 1.1em; transition: all 0.2s; }
        .ordering-word:hover { background: rgba(255,215,0,0.4); }
        .ordering-word.placed { opacity: 0.4; cursor: default; }
        .matching-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .matching-column h4 { text-align: center; margin-bottom: 15px; color: #7DD3FC; }
        .matching-item { background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); padding: 15px; border-radius: 10px; margin-bottom: 10px; cursor: pointer; text-align: center; transition: all 0.2s; }
        .matching-item:hover { border-color: #7DD3FC; }
        .matching-item.selected { border-color: #FFD700; background: rgba(255,215,0,0.2); }
        .matching-item.matched { border-color: #06D6A0; background: rgba(6,214,160,0.2); cursor: default; }
        .feedback { padding: 15px; border-radius: 10px; margin-top: 15px; display: none; font-weight: 500; }
        .feedback.show { display: block; }
        .feedback.correct { background: rgba(6,214,160,0.2); border-left: 4px solid #06D6A0; }
        .feedback.wrong { background: rgba(230,57,70,0.2); border-left: 4px solid #E63946; }
        .next-btn { background: linear-gradient(135deg, #06D6A0, #7DD3FC); border: none; padding: 15px 40px; border-radius: 12px; color: white; font-size: 1.2em; font-weight: 600; cursor: pointer; margin-top: 20px; display: none; }
        .next-btn.show { display: inline-block; }
        .results-section { text-align: center; display: none; }
        .results-section.active { display: block; }
        .results-icon { font-size: 5em; margin-bottom: 20px; }
        .results-score { font-family: 'Fredoka', sans-serif; font-size: 3em; color: #FFD700; margin-bottom: 10px; }
        .results-gems { font-size: 1.5em; color: #7DD3FC; margin-bottom: 30px; }
        .results-btn { background: linear-gradient(135deg, #667eea, #764ba2); border: none; padding: 15px 40px; border-radius: 12px; color: white; font-size: 1.1em; cursor: pointer; margin: 10px; }
        .results-btn:hover { transform: scale(1.05); }
        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } .matching-container { grid-template-columns: 1fr; } .level-btn { display: block; margin: 10px auto; } }
    </style>
</head>
<body>

<button class="home-btn" onclick="goHome()">üè†</button>

<div class="container">
    <div class="station-header">
        <div class="station-icon">üîó</div>
        <h1 class="station-title">Station 8: N√ºrnberg</h1>
        <p class="station-subtitle">Konnektoren - deshalb, trotzdem, au√üerdem...</p>
    </div>

    <div class="section">
        <h2>üìñ Die Geschichte</h2>
        <div class="story-box">
            <p>Die Freunde kommen in N√ºrnberg an. Die Stadt ist alt und sch√∂n. <strong>Au√üerdem</strong> ist sie ber√ºhmt f√ºr den Weihnachtsmarkt.</p>
            <p><strong>Sara:</strong> <em>"Es ist kalt, <strong>deshalb</strong> sollten wir warme Getr√§nke kaufen."</em></p>
            <p><strong>Leon:</strong> <em>"Gute Idee! <strong>Danach</strong> suchen wir den Kristall."</em></p>
            <p>Sie treffen einen Marktverk√§ufer namens <strong>Herr Fischer</strong>. Er verkauft Lebkuchen.</p>
            <p><strong>Herr Fischer:</strong> <em>"Ihr sucht einen Kristall? Ich wei√ü etwas <strong>dar√ºber</strong>. <strong>Allerdings</strong> ist es ein Geheimnis."</em></p>
            <p><strong>Mia:</strong> <em>"Bitte erz√§hlen Sie uns! <strong>Sonst</strong> finden wir ihn nie!"</em></p>
            <p><strong>Herr Fischer:</strong> <em>"Na gut. Der Kristall ist in der Burg. <strong>Jedoch</strong> ist der Eingang versteckt. Ihr m√ºsst <strong>zuerst</strong> den Brunnen finden. <strong>Dann</strong> seht ihr einen geheimen Weg."</em></p>
            <p><strong>Tim:</strong> <em>"Das klingt schwer. <strong>Trotzdem</strong> werden wir es versuchen!"</em></p>
            <p>Die Freunde gehen zur Burg. Es ist dunkel, <strong>aber</strong> sie haben Lampen. <strong>Zuerst</strong> suchen sie den Brunnen. <strong>Dann</strong> finden sie einen kleinen Tunnel.</p>
            <p><strong>Sara:</strong> <em>"Der Tunnel ist eng, <strong>trotzdem</strong> passen wir durch."</em></p>
            <p>Am Ende des Tunnels liegt ein <strong>orangener Kristall</strong>!</p>
            <p><strong>Leon:</strong> <em>"Wir haben es geschafft! <strong>Deshalb</strong> sind wir so ein gutes Team!"</em></p>
            <p><em>"Der achte Kristall!"</em> rufen alle.</p>
        </div>
    </div>

    <div class="section">
        <button class="collapsible" onclick="toggleGrammar()">
            üìö Grammatik: Konnektoren
            <span id="grammarArrow">‚ñº</span>
        </button>
        <div class="collapsible-content" id="grammarContent">
            <div class="collapsible-inner">
                <h3>Was sind Konnektoren?</h3>
                <p>Konnektoren verbinden zwei <strong>Haupts√§tze</strong>. Im Gegensatz zu Nebensatz-Konjunktionen steht das Verb auf <strong>Position 2</strong>.</p>

                <div class="grammar-warning">
                    <p><strong>Konjunktion (Position 0):</strong> Ich bin m√ºde, <strong>und</strong> ich gehe schlafen.</p>
                    <p><strong>Konnektor (Position 1):</strong> Ich bin m√ºde, <strong>deshalb</strong> <strong>gehe</strong> ich schlafen.</p>
                </div>

                <h3>Kausale Konnektoren (Grund ‚Üí Folge)</h3>
                <table class="grammar-table">
                    <tr><th>Konnektor</th><th>Bedeutung</th><th>Beispiel</th></tr>
                    <tr><td><strong>deshalb</strong></td><td>darum, deswegen</td><td>Es regnet, <strong>deshalb</strong> bleibe ich zu Hause.</td></tr>
                    <tr><td><strong>deswegen</strong></td><td>= deshalb</td><td>Ich bin m√ºde, <strong>deswegen</strong> gehe ich schlafen.</td></tr>
                    <tr><td><strong>darum</strong></td><td>= deshalb</td><td>Er hat Hunger, <strong>darum</strong> isst er.</td></tr>
                    <tr><td><strong>daher</strong></td><td>= deshalb</td><td>Sie lernt viel, <strong>daher</strong> besteht sie die Pr√ºfung.</td></tr>
                </table>

                <h3>Konzessive Konnektoren (Gegensatz)</h3>
                <table class="grammar-table">
                    <tr><th>Konnektor</th><th>Bedeutung</th><th>Beispiel</th></tr>
                    <tr><td><strong>trotzdem</strong></td><td>aber dennoch</td><td>Es regnet, <strong>trotzdem</strong> gehe ich raus.</td></tr>
                    <tr><td><strong>dennoch</strong></td><td>= trotzdem</td><td>Er ist m√ºde, <strong>dennoch</strong> arbeitet er weiter.</td></tr>
                    <tr><td><strong>jedoch</strong></td><td>aber</td><td>Der Film ist lang, <strong>jedoch</strong> sehr interessant.</td></tr>
                    <tr><td><strong>allerdings</strong></td><td>aber</td><td>Das Essen ist gut, <strong>allerdings</strong> teuer.</td></tr>
                </table>

                <h3>Additive Konnektoren (Addition)</h3>
                <table class="grammar-table">
                    <tr><th>Konnektor</th><th>Bedeutung</th><th>Beispiel</th></tr>
                    <tr><td><strong>au√üerdem</strong></td><td>zus√§tzlich</td><td>Er spricht Deutsch. <strong>Au√üerdem</strong> lernt er Spanisch.</td></tr>
                    <tr><td><strong>zus√§tzlich</strong></td><td>+ noch</td><td>Ich arbeite. <strong>Zus√§tzlich</strong> studiere ich.</td></tr>
                </table>

                <h3>Temporale Konnektoren (Zeit)</h3>
                <table class="grammar-table">
                    <tr><th>Konnektor</th><th>Bedeutung</th><th>Beispiel</th></tr>
                    <tr><td><strong>zuerst</strong></td><td>als erstes</td><td><strong>Zuerst</strong> lerne ich, dann entspanne ich.</td></tr>
                    <tr><td><strong>dann/danach</strong></td><td>nachher</td><td>Ich esse, <strong>dann</strong> gehe ich.</td></tr>
                    <tr><td><strong>schlie√ülich</strong></td><td>am Ende</td><td><strong>Schlie√ülich</strong> haben wir es geschafft.</td></tr>
                </table>

                <h3>Andere wichtige Konnektoren</h3>
                <table class="grammar-table">
                    <tr><th>Konnektor</th><th>Bedeutung</th><th>Beispiel</th></tr>
                    <tr><td><strong>sonst</strong></td><td>wenn nicht</td><td>Beeil dich, <strong>sonst</strong> kommst du zu sp√§t.</td></tr>
                    <tr><td><strong>also</strong></td><td>Schlussfolgerung</td><td>Es regnet, <strong>also</strong> nehme ich den Schirm.</td></tr>
                </table>

                <h3>‚ö†Ô∏è Wortstellung</h3>
                <div class="grammar-note">
                    <p>Nach Konnektoren: <strong>Konnektor + Verb + Subjekt</strong></p>
                    <p>Es regnet. <strong>Deshalb gehe ich</strong> nicht raus.</p>
                    <p>Nach Konjunktionen (und, aber, oder): <strong>Konjunktion + Subjekt + Verb</strong></p>
                    <p>Es regnet, <strong>aber ich gehe</strong> raus.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>üìù Wortschatz</h2>
        <div class="vocab-grid">
            <div class="vocab-item"><span class="vocab-emoji">üè∞</span><div><div class="vocab-word">die Burg</div><div class="vocab-meaning">altes Schloss, oft auf einem Berg</div></div></div>
            <div class="vocab-item"><span class="vocab-emoji">‚õ≤</span><div><div class="vocab-word">der Brunnen</div><div class="vocab-meaning">Wasser kommt aus der Erde</div></div></div>
            <div class="vocab-item"><span class="vocab-emoji">üöá</span><div><div class="vocab-word">der Tunnel</div><div class="vocab-meaning">Weg unter der Erde</div></div></div>
            <div class="vocab-item"><span class="vocab-emoji">üç™</span><div><div class="vocab-word">der Lebkuchen</div><div class="vocab-meaning">s√º√ües Geb√§ck aus N√ºrnberg</div></div></div>
            <div class="vocab-item"><span class="vocab-emoji">ü§´</span><div><div class="vocab-word">das Geheimnis</div><div class="vocab-meaning">etwas, das niemand wei√ü</div></div></div>
            <div class="vocab-item"><span class="vocab-emoji">üìè</span><div><div class="vocab-word">eng</div><div class="vocab-meaning">nicht breit, schmal</div></div></div>
            <div class="vocab-item"><span class="vocab-emoji">üîó</span><div><div class="vocab-word">verbinden</div><div class="vocab-meaning">zusammen machen</div></div></div>
            <div class="vocab-item"><span class="vocab-emoji">‚úÖ</span><div><div class="vocab-word">schaffen</div><div class="vocab-meaning">erfolgreich machen</div></div></div>
        </div>
    </div>

    <div class="section level-selection" id="levelSelection">
        <h2>üéÆ W√§hle dein Level</h2>
        <p style="margin-bottom: 20px; color: #E0F4FF;">30 Fragen zu Konnektoren!</p>
        <button class="level-btn level-rubin" onclick="startQuiz('rubin')"><span class="level-dot dot-rubin"></span>Rubin<br><small>Einfach</small></button>
        <button class="level-btn level-smaragd" onclick="startQuiz('smaragd')"><span class="level-dot dot-smaragd"></span>Smaragd<br><small>Mittel</small></button>
        <button class="level-btn level-amethyst" onclick="startQuiz('amethyst')"><span class="level-dot dot-amethyst"></span>Amethyst<br><small>Schwer</small></button>
    </div>

    <div class="section quiz-area" id="quizArea">
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <div class="question-counter" id="questionCounter">Frage 1 von 30</div>
        <div class="question-box" id="questionBox"></div>
        <div class="feedback" id="feedback"></div>
        <button class="next-btn" id="nextBtn" onclick="nextQuestion()">Weiter ‚Üí</button>
    </div>

    <div class="section results-section" id="resultsSection">
        <div class="results-icon" id="resultsIcon">üèÜ</div>
        <div class="results-score" id="resultsScore">0 / 30</div>
        <div class="results-gems" id="resultsGems">+0 Edelsteine üíé</div>
        <p id="resultsMessage" style="margin-bottom: 20px;"></p>
        <button class="results-btn" onclick="restartQuiz()">üîÑ Nochmal spielen</button>
        <button class="results-btn" onclick="goHome()">üè† Zur Karte</button>
    </div>
</div>

<script>
const QUESTIONS_RUBIN = [
    // TEXTVERST√ÑNDNIS (8)
    { type: 'mc', context: 'üìñ Textverst√§ndnis', question: 'Wof√ºr ist N√ºrnberg ber√ºhmt?', options: ['F√ºr den Weihnachtsmarkt', 'F√ºr den Strand', 'F√ºr die Berge', 'F√ºr den Zoo'], correct: 0 },
    { type: 'mc', context: 'üìñ Textverst√§ndnis', question: 'Was verkauft Herr Fischer?', options: ['Lebkuchen', 'Bratwurst', 'Kaffee', 'Blumen'], correct: 0 },
    { type: 'mc', context: 'üìñ Textverst√§ndnis', question: 'Wo ist der Kristall versteckt?', options: ['In der Burg', 'Im Markt', 'Im Brunnen', 'Im Tunnel'], correct: 0 },
    { type: 'mc', context: 'üìñ Textverst√§ndnis', question: 'Welche Farbe hat der achte Kristall?', options: ['Orange', 'Blau', 'Gr√ºn', 'Rot'], correct: 0 },
    { type: 'mc', context: 'üìñ Textverst√§ndnis', question: 'Was m√ºssen die Freunde zuerst finden?', options: ['Den Brunnen', 'Den Tunnel', 'Die Burg', 'Den Markt'], correct: 0 },
    { type: 'mc', context: 'üìñ Textverst√§ndnis', question: 'Wie ist der Tunnel?', options: ['Eng', 'Breit', 'Hell', 'Kurz'], correct: 0 },
    { type: 'mc', context: 'üìñ Textverst√§ndnis', question: 'Warum wollen sie warme Getr√§nke kaufen?', options: ['Weil es kalt ist', 'Weil sie Hunger haben', 'Weil sie m√ºde sind', 'Weil sie durstig sind'], correct: 0 },
    { type: 'mc', context: 'üìñ Textverst√§ndnis', question: 'Was ist ein Geheimnis?', options: ['Etwas, das niemand wei√ü', 'Etwas Gro√ües', 'Etwas Altes', 'Etwas Neues'], correct: 0 },
    // DESHALB (5)
    { type: 'mc', context: '‚úèÔ∏è deshalb', question: 'Es regnet, _____ bleibe ich zu Hause.', options: ['deshalb', 'trotzdem', 'au√üerdem', 'sonst'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è deshalb', question: 'Ich bin m√ºde, _____ gehe ich ins Bett.', options: ['deshalb', 'trotzdem', 'au√üerdem', 'jedoch'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è deshalb', question: 'Er hat Hunger, _____ isst er.', options: ['deshalb', 'trotzdem', 'au√üerdem', 'sonst'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è deshalb', question: 'Sie lernt viel, _____ besteht sie die Pr√ºfung.', options: ['deshalb', 'trotzdem', 'au√üerdem', 'jedoch'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è deshalb', question: '"Deshalb" bedeutet...', options: ['Grund ‚Üí Folge', 'Gegensatz', 'Zeit', 'Addition'], correct: 0 },
    // TROTZDEM (5)
    { type: 'mc', context: '‚úèÔ∏è trotzdem', question: 'Es regnet, _____ gehe ich raus.', options: ['trotzdem', 'deshalb', 'au√üerdem', 'sonst'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è trotzdem', question: 'Er ist krank, _____ geht er zur Arbeit.', options: ['trotzdem', 'deshalb', 'au√üerdem', 'sonst'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è trotzdem', question: 'Der Film ist lang, _____ sehe ich ihn gern.', options: ['trotzdem', 'deshalb', 'au√üerdem', 'dann'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è trotzdem', question: 'Sie ist m√ºde, _____ arbeitet sie weiter.', options: ['trotzdem', 'deshalb', 'au√üerdem', 'sonst'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è trotzdem', question: '"Trotzdem" bedeutet...', options: ['Gegensatz', 'Grund', 'Zeit', 'Addition'], correct: 0 },
    // AUSSERDEM (4)
    { type: 'mc', context: '‚úèÔ∏è au√üerdem', question: 'Er spricht Deutsch. _____ lernt er Spanisch.', options: ['Au√üerdem', 'Deshalb', 'Trotzdem', 'Sonst'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è au√üerdem', question: 'Ich arbeite. _____ studiere ich.', options: ['Au√üerdem', 'Deshalb', 'Trotzdem', 'Dann'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è au√üerdem', question: '"Au√üerdem" bedeutet...', options: ['zus√§tzlich', 'darum', 'aber', 'wenn nicht'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è au√üerdem', question: 'Das Essen ist gut. _____ ist es billig.', options: ['Au√üerdem', 'Deshalb', 'Trotzdem', 'Jedoch'], correct: 0 },
    // SONST, DANN (4)
    { type: 'mc', context: '‚úèÔ∏è sonst', question: 'Beeil dich, _____ kommst du zu sp√§t!', options: ['sonst', 'deshalb', 'au√üerdem', 'dann'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è sonst', question: 'Lern mehr, _____ bestehst du die Pr√ºfung nicht!', options: ['sonst', 'deshalb', 'trotzdem', 'dann'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è dann', question: 'Zuerst esse ich, _____ gehe ich spazieren.', options: ['dann', 'sonst', 'deshalb', 'trotzdem'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è dann', question: 'Ich dusche, _____ fr√ºhst√ºcke ich.', options: ['dann', 'sonst', 'deshalb', 'trotzdem'], correct: 0 },
    // ORDERING + MATCHING (2)
    { type: 'order', context: 'üîÄ Satzstellung', question: 'Bringe die W√∂rter in die richtige Reihenfolge:', words: ['Es', 'regnet', ',', 'deshalb', 'bleibe', 'ich', 'zu', 'Hause', '.'], correct: ['Es', 'regnet', ',', 'deshalb', 'bleibe', 'ich', 'zu', 'Hause', '.'] },
    { type: 'match', context: 'üîó Zuordnung', question: 'Ordne zu:', pairs: [{ left: 'deshalb', right: 'Grund' }, { left: 'trotzdem', right: 'Gegensatz' }, { left: 'au√üerdem', right: 'Addition' }, { left: 'sonst', right: 'wenn nicht' }]}
];

const QUESTIONS_SMARAGD = [
    // TEXTVERST√ÑNDNIS (5)
    { type: 'gap', context: 'üìñ Textverst√§ndnis', question: 'Es ist kalt, _____ sollten wir warme Getr√§nke kaufen.', answer: 'deshalb', alternatives: ['Deshalb'] },
    { type: 'gap', context: 'üìñ Textverst√§ndnis', question: 'Das klingt schwer. _____ werden wir es versuchen!', answer: 'Trotzdem', alternatives: ['trotzdem'] },
    { type: 'gap', context: 'üìñ Textverst√§ndnis', question: 'Ihr m√ºsst _____ den Brunnen finden. _____ seht ihr einen geheimen Weg.', answer: 'zuerst', alternatives: ['Zuerst'] },
    { type: 'mc', context: 'üìñ Textverst√§ndnis', question: 'Was bedeutet "sonst finden wir ihn nie"?', options: ['Wenn nicht, finden wir ihn nie', 'Wir finden ihn sicher', 'Wir wollen nicht suchen', 'Wir haben ihn schon gefunden'], correct: 0 },
    { type: 'mc', context: 'üìñ Textverst√§ndnis', question: 'Was bedeutet "jedoch ist der Eingang versteckt"?', options: ['Aber der Eingang ist versteckt', 'Der Eingang ist nicht versteckt', 'Der Eingang ist offen', 'Es gibt keinen Eingang'], correct: 0 },
    // WORTSTELLUNG (6)
    { type: 'mc', context: '‚úèÔ∏è Wortstellung', question: 'Welcher Satz ist richtig?', options: ['Ich bin m√ºde, deshalb gehe ich schlafen.', 'Ich bin m√ºde, deshalb ich gehe schlafen.', 'Ich bin m√ºde, deshalb schlafen gehe ich.', 'Ich bin m√ºde deshalb gehe ich schlafen.'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Wortstellung', question: 'Welcher Satz ist richtig?', options: ['Es regnet, trotzdem gehe ich raus.', 'Es regnet, trotzdem ich gehe raus.', 'Es regnet trotzdem gehe ich raus.', 'Es regnet, trotzdem raus gehe ich.'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Wortstellung', question: 'Was ist der Unterschied zwischen "und" und "deshalb"?', options: ['Bei "deshalb" kommt das Verb vor dem Subjekt', 'Kein Unterschied', 'Bei "und" kommt das Verb vor dem Subjekt', '"Deshalb" braucht kein Komma'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Wortstellung', question: 'Welcher Satz ist FALSCH?', options: ['Es regnet, deshalb ich bleibe zu Hause.', 'Es regnet, deshalb bleibe ich zu Hause.', 'Es regnet. Deshalb bleibe ich zu Hause.', 'Ich bleibe zu Hause, es regnet deshalb.'], correct: 0 },
    { type: 'gap', context: '‚úèÔ∏è Wortstellung', question: 'Er ist krank, trotzdem _____ er zur Arbeit. (gehen)', answer: 'geht', alternatives: ['Geht'] },
    { type: 'gap', context: '‚úèÔ∏è Wortstellung', question: 'Sie hat viel gelernt, deshalb _____ sie die Pr√ºfung. (bestehen)', answer: 'besteht', alternatives: ['Besteht'] },
    // SYNONYME (5)
    { type: 'mc', context: '‚úèÔ∏è Synonyme', question: 'Welches Wort ist ein Synonym f√ºr "deshalb"?', options: ['deswegen', 'trotzdem', 'au√üerdem', 'jedoch'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Synonyme', question: 'Welches Wort ist ein Synonym f√ºr "trotzdem"?', options: ['dennoch', 'deshalb', 'au√üerdem', 'darum'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Synonyme', question: '"Darum", "deswegen", "daher" bedeuten alle...', options: ['deshalb', 'trotzdem', 'au√üerdem', 'sonst'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Synonyme', question: '"Jedoch" und "allerdings" sind √§hnlich wie...', options: ['aber', 'und', 'deshalb', 'dann'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Synonyme', question: '"Schlie√ülich" bedeutet...', options: ['am Ende', 'am Anfang', 'in der Mitte', 'nie'], correct: 0 },
    // BEDEUTUNGSUNTERSCHIEDE (6)
    { type: 'mc', context: '‚úèÔ∏è Bedeutung', question: 'Er ist krank. _____ bleibt er zu Hause. (logisch)', options: ['Deshalb', 'Trotzdem', 'Au√üerdem', 'Jedoch'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Bedeutung', question: 'Er ist krank. _____ geht er zur Arbeit. (√ºberraschend)', options: ['Trotzdem', 'Deshalb', 'Au√üerdem', 'Darum'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Bedeutung', question: 'Lern mehr! _____ bestehst du nicht. (Warnung)', options: ['Sonst', 'Deshalb', 'Trotzdem', 'Au√üerdem'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Bedeutung', question: 'Das Essen ist gut. _____ ist es billig. (zus√§tzlich)', options: ['Au√üerdem', 'Deshalb', 'Trotzdem', 'Sonst'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Bedeutung', question: '_____ dusche ich. _____ fr√ºhst√ºcke ich. (Reihenfolge)', options: ['Zuerst ... Dann', 'Dann ... Zuerst', 'Deshalb ... Trotzdem', 'Sonst ... Au√üerdem'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Bedeutung', question: 'Es regnet. _____ nehme ich den Schirm. (Schlussfolgerung)', options: ['Also', 'Sonst', 'Trotzdem', 'Au√üerdem'], correct: 0 },
    // ORDERING + MATCHING (4)
    { type: 'order', context: 'üîÄ Satzstellung', question: 'Bringe die W√∂rter in die richtige Reihenfolge:', words: ['Er', 'ist', 'm√ºde', ',', 'trotzdem', 'arbeitet', 'er', '.'], correct: ['Er', 'ist', 'm√ºde', ',', 'trotzdem', 'arbeitet', 'er', '.'] },
    { type: 'order', context: 'üîÄ Satzstellung', question: 'Bringe die W√∂rter in die richtige Reihenfolge:', words: ['Zuerst', 'esse', 'ich', ',', 'dann', 'gehe', 'ich', '.'], correct: ['Zuerst', 'esse', 'ich', ',', 'dann', 'gehe', 'ich', '.'] },
    { type: 'match', context: 'üîó Synonyme', question: 'Ordne zu:', pairs: [{ left: 'deshalb', right: 'deswegen' }, { left: 'trotzdem', right: 'dennoch' }, { left: 'jedoch', right: 'allerdings' }, { left: 'dann', right: 'danach' }]},
    { type: 'match', context: 'üîó Bedeutung', question: 'Ordne zu:', pairs: [{ left: 'deshalb', right: 'Grund ‚Üí Folge' }, { left: 'trotzdem', right: 'Gegensatz' }, { left: 'sonst', right: 'Warnung' }, { left: 'au√üerdem', right: 'Addition' }]}
];

const QUESTIONS_AMETHYST = [
    // KOMPLEXE TEXTFRAGEN (4)
    { type: 'mc', context: 'üìñ Textverst√§ndnis', question: '"Das klingt schwer. Trotzdem werden wir es versuchen." - Was zeigt "trotzdem"?', options: ['Die Freunde geben nicht auf', 'Die Freunde geben auf', 'Es ist leicht', 'Sie haben keine Zeit'], correct: 0 },
    { type: 'gap', context: 'üìñ Textverst√§ndnis', question: 'Der Film ist lang, _____ sehr interessant.', answer: 'jedoch', alternatives: ['Jedoch', 'allerdings', 'Allerdings'] },
    { type: 'mc', context: 'üìñ Textverst√§ndnis', question: '"Allerdings ist es ein Geheimnis" - was dr√ºckt "allerdings" aus?', options: ['Eine Einschr√§nkung', 'Einen Grund', 'Eine Zeit', 'Eine Addition'], correct: 0 },
    { type: 'mc', context: 'üìñ Textverst√§ndnis', question: 'Welche Reihenfolge? "Zuerst den Brunnen finden, dann den Weg sehen"?', options: ['1. Brunnen 2. Weg', '1. Weg 2. Brunnen', 'Gleichzeitig', 'Egal'], correct: 0 },
    // WEIL VS. DESHALB (4)
    { type: 'mc', context: '‚úèÔ∏è weil vs. deshalb', question: 'Ich bin m√ºde, _____ ich wenig geschlafen habe.', options: ['weil', 'deshalb', 'trotzdem', 'au√üerdem'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è weil vs. deshalb', question: 'Ich habe wenig geschlafen, _____ bin ich m√ºde.', options: ['deshalb', 'weil', 'obwohl', 'au√üerdem'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è weil vs. deshalb', question: 'Was ist der Unterschied zwischen "weil" und "deshalb"?', options: ['weil = Nebensatz, deshalb = Hauptsatz', 'Kein Unterschied', 'weil = Hauptsatz, deshalb = Nebensatz', 'weil = Gegenwart, deshalb = Vergangenheit'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è weil vs. deshalb', question: 'Welcher Satz ist richtig?', options: ['Es regnet, deshalb bleibe ich zu Hause.', 'Es regnet, deshalb ich zu Hause bleibe.', 'Es regnet deshalb bleibe ich zu Hause.', 'Deshalb es regnet, bleibe ich zu Hause.'], correct: 0 },
    // OBWOHL VS. TROTZDEM (4)
    { type: 'mc', context: '‚úèÔ∏è obwohl vs. trotzdem', question: 'Er ist krank, _____ er zur Arbeit geht.', options: ['obwohl', 'trotzdem', 'weil', 'deshalb'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è obwohl vs. trotzdem', question: 'Er ist krank, _____ geht er zur Arbeit.', options: ['trotzdem', 'obwohl', 'weil', 'deshalb'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è obwohl vs. trotzdem', question: 'Was ist der Unterschied zwischen "obwohl" und "trotzdem"?', options: ['obwohl = Nebensatz, trotzdem = Hauptsatz', 'Kein Unterschied', 'obwohl = Hauptsatz, trotzdem = Nebensatz', 'obwohl = Grund, trotzdem = Zeit'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è obwohl vs. trotzdem', question: 'Welcher Satz ist FALSCH?', options: ['Er ist krank. Trotzdem er geht zur Arbeit.', 'Er ist krank. Trotzdem geht er zur Arbeit.', 'Obwohl er krank ist, geht er zur Arbeit.', 'Er geht zur Arbeit, obwohl er krank ist.'], correct: 0 },
    // KOMPLEXE S√ÑTZE (6)
    { type: 'gap', context: '‚úèÔ∏è L√ºckentext', question: 'Es ist sp√§t, _____ muss ich noch arbeiten.', answer: 'trotzdem', alternatives: ['Trotzdem'] },
    { type: 'gap', context: '‚úèÔ∏è L√ºckentext', question: 'Du musst mehr lernen, _____ bestehst du die Pr√ºfung nicht.', answer: 'sonst', alternatives: ['Sonst'] },
    { type: 'mc', context: '‚úèÔ∏è Komplexe S√§tze', question: 'Welcher Konnektor passt? "Das Essen ist teuer, _____ sehr gut."', options: ['jedoch', 'deshalb', 'au√üerdem', 'sonst'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Komplexe S√§tze', question: 'Welcher Konnektor passt? "Er arbeitet viel. _____ hat er keine Zeit."', options: ['Daher', 'Trotzdem', 'Au√üerdem', 'Jedoch'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Komplexe S√§tze', question: 'Welcher Konnektor passt? "Ich habe kein Geld. _____ kann ich nicht einkaufen."', options: ['Deshalb', 'Trotzdem', 'Au√üerdem', 'Jedoch'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Komplexe S√§tze', question: 'Welcher Satz ist RICHTIG?', options: ['Er ist m√ºde, au√üerdem ist er krank.', 'Er ist m√ºde au√üerdem ist er krank.', 'Er ist m√ºde, au√üerdem er ist krank.', 'Er ist m√ºde, au√üerdem krank ist er.'], correct: 0 },
    // FEHLERSUCHE (4)
    { type: 'mc', context: '‚úèÔ∏è Fehlersuche', question: 'Welcher Satz ist FALSCH?', options: ['Ich bin m√ºde, deshalb ich gehe schlafen.', 'Ich bin m√ºde, deshalb gehe ich schlafen.', 'Ich gehe schlafen, ich bin deshalb m√ºde.', 'Ich bin m√ºde. Deshalb gehe ich schlafen.'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Fehlersuche', question: 'Welcher Satz ist FALSCH?', options: ['Es regnet. Trotzdem ich gehe raus.', 'Es regnet. Trotzdem gehe ich raus.', 'Obwohl es regnet, gehe ich raus.', 'Ich gehe raus, obwohl es regnet.'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Fehlersuche', question: 'Welcher Satz ist RICHTIG?', options: ['Zuerst esse ich, dann gehe ich.', 'Zuerst ich esse, dann ich gehe.', 'Zuerst esse ich dann gehe ich.', 'Zuerst ich esse dann ich gehe.'], correct: 0 },
    { type: 'mc', context: '‚úèÔ∏è Fehlersuche', question: 'Welcher Satz ist RICHTIG?', options: ['Beeil dich, sonst kommst du zu sp√§t.', 'Beeil dich sonst kommst du zu sp√§t.', 'Beeil dich, sonst du kommst zu sp√§t.', 'Beeil dich, sonst zu sp√§t kommst du.'], correct: 0 },
    // ORDERING + MATCHING (4)
    { type: 'order', context: 'üîÄ Satzstellung', question: 'Bringe die W√∂rter in die richtige Reihenfolge:', words: ['Das', 'Essen', 'ist', 'gut', ',', 'allerdings', 'ist', 'es', 'teuer', '.'], correct: ['Das', 'Essen', 'ist', 'gut', ',', 'allerdings', 'ist', 'es', 'teuer', '.'] },
    { type: 'order', context: 'üîÄ Satzstellung', question: 'Bringe die W√∂rter in die richtige Reihenfolge:', words: ['Beeil', 'dich', ',', 'sonst', 'kommst', 'du', 'zu', 'sp√§t', '.'], correct: ['Beeil', 'dich', ',', 'sonst', 'kommst', 'du', 'zu', 'sp√§t', '.'] },
    { type: 'match', context: 'üîó Nebensatz vs. Konnektor', question: 'Ordne zu:', pairs: [{ left: 'weil (Nebensatz)', right: 'deshalb (Konnektor)' }, { left: 'obwohl (Nebensatz)', right: 'trotzdem (Konnektor)' }, { left: 'wenn (Nebensatz)', right: 'sonst (Konnektor)' }, { left: 'und (Konjunktion)', right: 'au√üerdem (Konnektor)' }]},
    { type: 'match', context: 'üîó Funktion', question: 'Ordne zu:', pairs: [{ left: 'zuerst', right: '1. Schritt' }, { left: 'dann/danach', right: '2. Schritt' }, { left: 'schlie√ülich', right: 'am Ende' }, { left: 'also', right: 'Schlussfolgerung' }]}
];

let currentQuestion = 0, score = 0, selectedLevel = '', currentQuestions = [];

function shuffle(array) { const arr = [...array]; for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; } return arr; }
function toggleGrammar() { const content = document.getElementById('grammarContent'); const arrow = document.getElementById('grammarArrow'); content.classList.toggle('open'); arrow.textContent = content.classList.contains('open') ? '‚ñ≤' : '‚ñº'; }

function startQuiz(level) {
    selectedLevel = level; currentQuestion = 0; score = 0;
    if (level === 'rubin') currentQuestions = shuffle(QUESTIONS_RUBIN);
    else if (level === 'smaragd') currentQuestions = shuffle(QUESTIONS_SMARAGD);
    else currentQuestions = shuffle(QUESTIONS_AMETHYST);
    document.getElementById('levelSelection').style.display = 'none';
    document.getElementById('quizArea').classList.add('active');
    showQuestion();
}

function showQuestion() {
    const q = currentQuestions[currentQuestion];
    const box = document.getElementById('questionBox');
    document.getElementById('progressFill').style.width = ((currentQuestion) / currentQuestions.length) * 100 + '%';
    document.getElementById('questionCounter').textContent = `Frage ${currentQuestion + 1} von ${currentQuestions.length}`;
    document.getElementById('feedback').className = 'feedback';
    document.getElementById('feedback').style.display = 'none';
    document.getElementById('nextBtn').classList.remove('show');

    let html = `<div class="question-context">${q.context}</div><div class="question-text">${q.question}</div>`;

    if (q.type === 'mc') {
        html += '<div class="options-grid">';
        shuffle(q.options.map((opt, idx) => ({ text: opt, originalIdx: idx }))).forEach((opt) => {
            html += `<button class="option-btn" onclick="checkMC(${opt.originalIdx}, ${q.correct}, this)">${opt.text}</button>`;
        });
        html += '</div>';
    } else if (q.type === 'gap') {
        html += `<input type="text" class="gap-input" id="gapInput" placeholder="..." onkeypress="if(event.key==='Enter')checkGap()"><br><button class="check-btn" onclick="checkGap()">Pr√ºfen</button>`;
    } else if (q.type === 'order') {
        html += '<div class="ordering-container"><div class="ordering-source" id="orderSource">';
        shuffle([...q.words]).forEach((word) => { html += `<span class="ordering-word" onclick="moveWord(this, 'toTarget')" data-word="${word}">${word}</span>`; });
        html += '</div><p style="text-align:center; color:#7DD3FC;">‚Üì Klicke die W√∂rter in der richtigen Reihenfolge ‚Üì</p><div class="ordering-target" id="orderTarget"></div><button class="check-btn" onclick="checkOrder()">Pr√ºfen</button></div>';
    } else if (q.type === 'match') {
        html += '<div class="matching-container"><div class="matching-column"><h4>Links</h4>';
        shuffle(q.pairs.map(p => p.left)).forEach(item => { html += `<div class="matching-item" data-type="left" data-value="${item}" onclick="selectMatch(this)">${item}</div>`; });
        html += '</div><div class="matching-column"><h4>Rechts</h4>';
        shuffle(q.pairs.map(p => p.right)).forEach(item => { html += `<div class="matching-item" data-type="right" data-value="${item}" onclick="selectMatch(this)">${item}</div>`; });
        html += '</div></div>';
    }
    box.innerHTML = html;
}

function checkMC(selected, correct, btn) {
    document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
    if (selected === correct) { btn.classList.add('correct'); showFeedback(true, 'Richtig! üéâ'); score++; }
    else { btn.classList.add('wrong'); document.querySelectorAll('.option-btn').forEach(b => { const idx = parseInt(b.getAttribute('onclick').match(/checkMC\((\d+)/)[1]); if (idx === correct) b.classList.add('correct'); }); showFeedback(false, 'Leider falsch.'); }
}

function checkGap() {
    const input = document.getElementById('gapInput');
    const q = currentQuestions[currentQuestion];
    const userAnswer = input.value.trim().toLowerCase();
    const alternatives = q.alternatives ? q.alternatives.map(a => a.toLowerCase()) : [];
    if (userAnswer === q.answer.toLowerCase() || alternatives.includes(userAnswer)) { input.classList.add('correct'); showFeedback(true, 'Richtig! üéâ'); score++; }
    else { input.classList.add('wrong'); showFeedback(false, `Die richtige Antwort ist: ${q.answer}`); }
    input.disabled = true;
}

function moveWord(element, direction) {
    if (element.classList.contains('placed')) return;
    const source = document.getElementById('orderSource'), target = document.getElementById('orderTarget');
    if (direction === 'toTarget') { const clone = element.cloneNode(true); clone.onclick = function() { moveWord(this, 'toSource'); }; target.appendChild(clone); element.classList.add('placed'); }
    else { source.querySelectorAll('.ordering-word').forEach(sw => { if (sw.dataset.word === element.dataset.word && sw.classList.contains('placed')) sw.classList.remove('placed'); }); element.remove(); }
}

function checkOrder() {
    const words = Array.from(document.getElementById('orderTarget').querySelectorAll('.ordering-word')).map(w => w.dataset.word);
    if (JSON.stringify(words) === JSON.stringify(currentQuestions[currentQuestion].correct)) { showFeedback(true, 'Richtig! üéâ'); score++; }
    else { showFeedback(false, `Richtige Reihenfolge: ${currentQuestions[currentQuestion].correct.join(' ')}`); }
}

let selectedMatch = null, matchedPairs = 0;

function selectMatch(element) {
    if (element.classList.contains('matched')) return;
    if (!selectedMatch) { selectedMatch = { element, type: element.dataset.type, value: element.dataset.value }; element.classList.add('selected'); }
    else {
        if (selectedMatch.type === element.dataset.type) { selectedMatch.element.classList.remove('selected'); selectedMatch = { element, type: element.dataset.type, value: element.dataset.value }; element.classList.add('selected'); }
        else {
            const pair = currentQuestions[currentQuestion].pairs.find(p => (p.left === selectedMatch.value && p.right === element.dataset.value) || (p.right === selectedMatch.value && p.left === element.dataset.value));
            if (pair) { element.classList.add('matched'); selectedMatch.element.classList.remove('selected'); selectedMatch.element.classList.add('matched'); matchedPairs++; if (matchedPairs === currentQuestions[currentQuestion].pairs.length) { showFeedback(true, 'Alle richtig! üéâ'); score++; matchedPairs = 0; } }
            else { element.classList.add('wrong'); setTimeout(() => element.classList.remove('wrong'), 500); }
            selectedMatch.element.classList.remove('selected'); selectedMatch = null;
        }
    }
}

function showFeedback(isCorrect, message) { const feedback = document.getElementById('feedback'); feedback.textContent = message; feedback.className = 'feedback show ' + (isCorrect ? 'correct' : 'wrong'); document.getElementById('nextBtn').classList.add('show'); }
function nextQuestion() { currentQuestion++; selectedMatch = null; matchedPairs = 0; if (currentQuestion >= currentQuestions.length) showResults(); else showQuestion(); }

function showResults() {
    document.getElementById('quizArea').classList.remove('active');
    document.getElementById('resultsSection').classList.add('active');
    const percentage = Math.round((score / currentQuestions.length) * 100);
    let gems = 0, icon = 'üèÜ', message = '';
    if (percentage >= 90) { gems = selectedLevel === 'amethyst' ? 30 : selectedLevel === 'smaragd' ? 20 : 10; icon = 'üèÜ'; message = 'Ausgezeichnet! Du hast den achten Kristall gefunden! üíé'; }
    else if (percentage >= 70) { gems = selectedLevel === 'amethyst' ? 20 : selectedLevel === 'smaragd' ? 15 : 8; icon = '‚≠ê'; message = 'Sehr gut!'; }
    else if (percentage >= 50) { gems = selectedLevel === 'amethyst' ? 10 : selectedLevel === 'smaragd' ? 8 : 5; icon = 'üí™'; message = 'Gut gemacht!'; }
    else { gems = 2; icon = 'üìö'; message = 'Lies die Grammatik nochmal!'; }
    document.getElementById('resultsIcon').textContent = icon;
    document.getElementById('resultsScore').textContent = `${score} / ${currentQuestions.length}`;
    document.getElementById('resultsGems').textContent = `+${gems} Edelsteine üíé`;
    document.getElementById('resultsMessage').textContent = message;
    localStorage.setItem('station8_gems', gems);
    localStorage.setItem('station8_completed', percentage >= 50);
}

function restartQuiz() { document.getElementById('resultsSection').classList.remove('active'); document.getElementById('levelSelection').style.display = 'block'; }
function goHome() { window.location.href = 'index.html'; }
</script>

</body>
</html>
